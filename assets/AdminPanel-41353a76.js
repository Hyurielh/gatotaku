import{k as f,j as e,P as q,l as F,T as U,r as g}from"./vendor-2e0792b2.js";import{s as l,u as J,S as V}from"./index-a67b5978.js";function H(){const[w,E]=f.useState([]),[b,j]=f.useState(""),[m,N]=f.useState(null),[y,c]=f.useState(null);f.useEffect(()=>{u()},[]);async function u(){const{data:a,error:s}=await l.from("categories").select("*").order("name");if(s){c("Error al cargar categorías");return}E(a||[])}async function k(a){if(a.preventDefault(),c(null),!b.trim())return;const{error:s}=await l.from("categories").insert({name:b.trim()});if(s){c("Error al crear categoría");return}j(""),u()}async function t(a){const{error:s}=await l.from("categories").delete().eq("id",a);if(s){c("Error al eliminar categoría");return}u()}async function n(a,s){const{error:v}=await l.from("categories").update({name:s}).eq("id",a);if(v){c("Error al actualizar categoría");return}N(null),u()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Categorías"}),y&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:y}),e.jsxs("form",{onSubmit:k,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:b,onChange:a=>j(a.target.value),placeholder:"Nueva categoría",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:w.map(a=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[m===a.id?e.jsx("input",{type:"text",defaultValue:a.name,onBlur:s=>n(a.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&n(a.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:a.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(a.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar categoría",children:e.jsx(F,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>t(a.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar categoría",children:e.jsx(U,{className:"h-5 w-5"})})]})]},a.id))})]})}function Q(){const[w,E]=f.useState([]),[b,j]=f.useState(""),[m,N]=f.useState(null),[y,c]=f.useState(null);f.useEffect(()=>{u()},[]);async function u(){const{data:a,error:s}=await l.from("anime").select("*").order("name");if(s){c("Error al cargar animes");return}E(a||[])}async function k(a){if(a.preventDefault(),c(null),!b.trim())return;const{error:s}=await l.from("anime").insert({name:b.trim()});if(s){c("Error al crear anime");return}j(""),u()}async function t(a){const{error:s}=await l.from("anime").delete().eq("id",a);if(s){c("Error al eliminar anime");return}u()}async function n(a,s){const{error:v}=await l.from("anime").update({name:s}).eq("id",a);if(v){c("Error al actualizar anime");return}N(null),u()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Animes"}),y&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:y}),e.jsxs("form",{onSubmit:k,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:b,onChange:a=>j(a.target.value),placeholder:"Nuevo anime",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:w.map(a=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[m===a.id?e.jsx("input",{type:"text",defaultValue:a.name,onBlur:s=>n(a.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&n(a.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:a.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(a.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar anime",children:e.jsx(F,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>t(a.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar anime",children:e.jsx(U,{className:"h-5 w-5"})})]})]},a.id))})]})}function Z(){const{session:w,loading:E}=J(),[b,j]=g.useState(()=>[]),[m,N]=g.useState([]),[y,c]=g.useState(!0),[u,k]=g.useState(()=>[]),[t,n]=g.useState(()=>({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0})),[a,s]=g.useState(null),[v,x]=g.useState(null),[W,C]=g.useState(!1),[D,$]=g.useState([]);if(E)return e.jsx("div",{children:"Loading..."});if(!w)return e.jsx("div",{children:"Unauthorized Access"});g.useEffect(()=>{I(),T(),z()},[]),g.useEffect(()=>{m.length>0&&!t.category_id&&n(r=>({...r,category_id:m[0].id}))},[m]);const L=async()=>{const r=D.map(async i=>{const d=i.name.split(".").pop(),A=`product-images/${`${Date.now()}.${d}`}`,{error:p}=await l.storage.from("product-images").upload(A,i);if(p)throw console.error("Upload error:",p),p;const{data:{publicUrl:P}}=l.storage.from("product-images").getPublicUrl(A);return P});return Promise.all(r)},O=async r=>{if(r.preventDefault(),y){x("Cargando categorías, por favor espere");return}if(m.length===0){x("No hay categorías disponibles. Cree una categoría primero.");return}C(!0),x(null);try{const i=t.category_id||m[0].id,d=m.find(o=>o.id===i);if(!d){console.error("Invalid category selection"),x("Categoría inválida. Por favor seleccione una categoría válida."),C(!1);return}const S=D.length>0?await L():t.images.filter(o=>o&&o.trim()!==""),A=S.length>0?S:["https://ik.imagekit.io/gatotaku/default-product-image.png"],p={name:t.name||null,description:t.description||null,price:parseFloat(t.price)||null,category_id:i||null,category:d.name,anime_id:t.anime_id||null,images:A,stock:Number(t.stock)||0};console.group("Product Insertion Debug"),console.log("Raw Form Data:",t),console.log("Selected Category:",d),console.log("Prepared Product Data:",p),Object.entries(p).forEach(([o,_])=>{console.log(`Field ${o}:`,_===null?"NULL":_===void 0?"UNDEFINED":_)}),console.groupEnd();const P=Object.entries(p).filter(([o,_])=>_===null&&o!=="anime_id"&&o!=="description").map(([o])=>o);if(P.length>0){console.error("Missing required fields:",P),x(`Campos requeridos faltantes: ${P.join(", ")}`),C(!1);return}let h;try{if(a?h=await l.from("products").update(p).eq("id",a).select():h=await l.from("products").insert(p).select(),h.error){console.error("Supabase Error Object:",h.error),console.error("Full Error Details:",{code:h.error.code,message:h.error.message,details:h.error.details,hint:h.error.hint}),console.error("Product Data Sent:",JSON.stringify(p,null,2)),console.error("Categories at time of error:",JSON.stringify(m,null,2));const o=h.error.message||"Error desconocido al guardar producto";x(`Error guardando producto: ${o}`),C(!1);return}console.log("Product Inserted Successfully:",h.data),n({name:"",description:"",price:"",category_id:m[0].id,anime_id:"",images:[""],stock:0}),$([]),s(null),I()}catch(o){console.error("Supabase Catch Block Error:",o),x(`Error de Supabase: ${o.message}`)}}catch(i){console.error("Unexpected Error submitting product:",i),x("Error inesperado al guardar el producto")}finally{C(!1)}};async function I(){const{data:r,error:i}=await l.from("products").select(`
        *,
        category_ref:categories(id, name),
        anime:anime(id, name)
      `).order("created_at",{ascending:!1});if(i){console.error("Error al cargar productos:",i),x("Error al cargar los productos");return}j(r||[])}async function T(){c(!0);const{data:r}=await l.from("categories").select("*").order("name");N(r||[]),c(!1)}async function z(){const{data:r}=await l.from("anime").select("*").order("name");k(r||[])}async function M(r){if(confirm("¿Estás seguro de que quieres eliminar este producto?"))try{const{error:i}=await l.from("products").delete().eq("id",r);if(i)throw i;I()}catch(i){console.error("Error al eliminar:",i),x(i.message||"Error al eliminar el producto")}}function R(r){n({name:r.name,price:r.price.toString(),category_id:r.category_id||"",anime_id:r.anime_id||"",description:r.description,images:r.images,stock:r.stock||0}),s(r.id)}function B(r,i){const d=[...t.images];d[r]=i,n({...t,images:d})}function G(){n({...t,images:[...t.images,""]})}function K(r){const i=t.images.filter((d,S)=>S!==r);n({...t,images:i})}return e.jsxs("div",{className:"admin-panel",children:[e.jsx(V,{title:"Panel de Administración",description:"Panel de administración de GATOTAKU"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Panel de Administración"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsx(H,{}),e.jsx(Q,{})]}),v&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded",children:v}),e.jsxs("form",{onSubmit:O,className:"bg-white p-6 rounded-lg shadow-md mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:a?"Editar Producto":"Nuevo Producto"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx("input",{type:"text",value:t.name,onChange:r=>n({...t,name:r.target.value}),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Precio"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"C$"})}),e.jsx("input",{type:"number",name:"price",step:"0.01",value:t.price,onChange:r=>n({...t,price:r.target.value}),className:"mt-1 block w-full pl-8 pr-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm"})]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Stock"}),e.jsx("input",{type:"number",name:"stock",value:t.stock,onChange:r=>n({...t,stock:parseInt(r.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsxs("select",{value:t.category_id,onChange:r=>n({...t,category_id:r.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),m.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Anime"}),e.jsxs("select",{value:t.anime_id,onChange:r=>n({...t,anime_id:r.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un anime"}),u.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:t.description,onChange:r=>n({...t,description:r.target.value}),className:"w-full p-2 border rounded",rows:3,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[t.images.map((r,i)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"url",value:r,onChange:d=>B(i,d.target.value),className:"flex-1 p-2 border rounded",placeholder:"URL de la imagen",required:!0}),e.jsx("button",{type:"button",onClick:()=>K(i),className:"px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600","aria-label":"Eliminar imagen",children:e.jsx("i",{className:"fas fa-trash"})})]},i)),e.jsxs("button",{type:"button",onClick:G,className:"mt-2 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Agregar imagen"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[a&&e.jsx("button",{type:"button",onClick:()=>{n({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0}),s(null)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600",children:[a?"Actualizar":"Crear"," Producto"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Anime"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(r=>{var i,d;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:r.images[0],alt:r.name,className:"h-10 w-10 rounded-full object-cover"}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:["$",r.price.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800",children:(i=r.category_ref)==null?void 0:i.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:(d=r.anime)==null?void 0:d.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:r.stock})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>R(r),className:"text-indigo-600 hover:text-indigo-900 mr-4","aria-label":"Editar producto",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{onClick:()=>M(r.id),className:"text-red-600 hover:text-red-900","aria-label":"Eliminar producto",children:e.jsx("i",{className:"fas fa-trash"})})]})]},r.id)})})]})})]})]})}export{Z as default};
