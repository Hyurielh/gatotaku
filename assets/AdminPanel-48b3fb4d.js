import{k as u,j as e,P as S,l as _,T as A,r as m}from"./vendor-9578a473.js";import{s as l,u as O,S as R}from"./index-f74bd664.js";function B(){const[N,y]=u.useState([]),[x,f]=u.useState(""),[c,b]=u.useState(null),[j,o]=u.useState(null);u.useEffect(()=>{t()},[]);async function t(){const{data:r,error:s}=await l.from("categories").select("*").order("name");if(s){o("Error al cargar categorías");return}y(r||[])}async function n(r){if(r.preventDefault(),o(null),!x.trim())return;const{error:s}=await l.from("categories").insert({name:x.trim()});if(s){o("Error al crear categoría");return}f(""),t()}async function g(r){const{error:s}=await l.from("categories").delete().eq("id",r);if(s){o("Error al eliminar categoría");return}t()}async function p(r,s){const{error:v}=await l.from("categories").update({name:s}).eq("id",r);if(v){o("Error al actualizar categoría");return}b(null),t()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Categorías"}),j&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:j}),e.jsxs("form",{onSubmit:n,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:r=>f(r.target.value),placeholder:"Nueva categoría",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:N.map(r=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[c===r.id?e.jsx("input",{type:"text",defaultValue:r.name,onBlur:s=>p(r.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&p(r.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:r.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(r.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar categoría",children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>g(r.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar categoría",children:e.jsx(A,{className:"h-5 w-5"})})]})]},r.id))})]})}function M(){const[N,y]=u.useState([]),[x,f]=u.useState(""),[c,b]=u.useState(null),[j,o]=u.useState(null);u.useEffect(()=>{t()},[]);async function t(){const{data:r,error:s}=await l.from("anime").select("*").order("name");if(s){o("Error al cargar animes");return}y(r||[])}async function n(r){if(r.preventDefault(),o(null),!x.trim())return;const{error:s}=await l.from("anime").insert({name:x.trim()});if(s){o("Error al crear anime");return}f(""),t()}async function g(r){const{error:s}=await l.from("anime").delete().eq("id",r);if(s){o("Error al eliminar anime");return}t()}async function p(r,s){const{error:v}=await l.from("anime").update({name:s}).eq("id",r);if(v){o("Error al actualizar anime");return}b(null),t()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Animes"}),j&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:j}),e.jsxs("form",{onSubmit:n,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:r=>f(r.target.value),placeholder:"Nuevo anime",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:N.map(r=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[c===r.id?e.jsx("input",{type:"text",defaultValue:r.name,onBlur:s=>p(r.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&p(r.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:r.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(r.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar anime",children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>g(r.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar anime",children:e.jsx(A,{className:"h-5 w-5"})})]})]},r.id))})]})}function J(){const{session:N,loading:y}=O(),[x,f]=m.useState(()=>[]),[c,b]=m.useState(()=>[]),[j,o]=m.useState(()=>[]),[t,n]=m.useState(()=>({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0})),[g,p]=m.useState(null),[r,s]=m.useState(null),[v,w]=m.useState(!1),[P,I]=m.useState([]);if(y)return e.jsx("div",{children:"Loading..."});if(!N)return e.jsx("div",{children:"Unauthorized Access"});m.useEffect(()=>{k(),F(),U()},[]),m.useEffect(()=>{c.length>0&&!t.category_id&&n(a=>({...a,category_id:c[0].id}))},[c]);const D=async()=>{const a=P.map(async i=>{const d=i.name.split(".").pop(),C=`product-images/${`${Date.now()}.${d}`}`,{error:E}=await l.storage.from("product-images").upload(C,i);if(E)throw console.error("Upload error:",E),E;const{data:{publicUrl:L}}=l.storage.from("product-images").getPublicUrl(C);return L});return Promise.all(a)},q=async a=>{a.preventDefault(),w(!0),s(null);try{const i={...t,category_id:t.category_id||(c.length>0?c[0].id:""),price:parseFloat(t.price).toFixed(2),stock:Number(t.stock)};if(!i.category_id){s("Por favor selecciona una categoría"),w(!1);return}const d=await D();i.images=d;let h;if(g?h=await l.from("products").update(i).eq("id",g):h=await l.from("products").insert(i),h.error){console.error("Database Operation Error:",h.error),s(`Error guardando producto: ${h.error.message}`);return}n({name:"",description:"",price:"",category_id:c.length>0?c[0].id:"",anime_id:"",images:[""],stock:0}),I([]),p(null),k()}catch(i){console.error("Error submitting product:",i),s("Error al guardar el producto")}finally{w(!1)}};async function k(){const{data:a,error:i}=await l.from("products").select(`
        *,
        category_ref:categories(id, name),
        anime:anime(id, name)
      `).order("created_at",{ascending:!1});if(i){console.error("Error al cargar productos:",i),s("Error al cargar los productos");return}f(a||[])}async function F(){const{data:a}=await l.from("categories").select("*").order("name");b(a||[])}async function U(){const{data:a}=await l.from("anime").select("*").order("name");o(a||[])}async function T(a){if(confirm("¿Estás seguro de que quieres eliminar este producto?"))try{const{error:i}=await l.from("products").delete().eq("id",a);if(i)throw i;k()}catch(i){console.error("Error al eliminar:",i),s(i.message||"Error al eliminar el producto")}}function $(a){n({name:a.name,price:a.price.toString(),category_id:a.category_id||"",anime_id:a.anime_id||"",description:a.description,images:a.images,stock:a.stock||0}),p(a.id)}function z(a,i){const d=[...t.images];d[a]=i,n({...t,images:d})}function G(){n({...t,images:[...t.images,""]})}function K(a){const i=t.images.filter((d,h)=>h!==a);n({...t,images:i})}return e.jsxs("div",{className:"admin-panel",children:[e.jsx(R,{title:"Panel de Administración",description:"Panel de administración de GATOTAKU"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Panel de Administración"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsx(B,{}),e.jsx(M,{})]}),r&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded",children:r}),e.jsxs("form",{onSubmit:q,className:"bg-white p-6 rounded-lg shadow-md mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:g?"Editar Producto":"Nuevo Producto"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>n({...t,name:a.target.value}),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Precio"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"C$"})}),e.jsx("input",{type:"number",name:"price",step:"0.01",value:t.price,onChange:a=>n({...t,price:a.target.value}),className:"mt-1 block w-full pl-8 pr-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm"})]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Stock"}),e.jsx("input",{type:"number",name:"stock",value:t.stock,onChange:a=>n({...t,stock:parseInt(a.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsxs("select",{value:t.category_id,onChange:a=>n({...t,category_id:a.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),c.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Anime"}),e.jsxs("select",{value:t.anime_id,onChange:a=>n({...t,anime_id:a.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un anime"}),j.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:t.description,onChange:a=>n({...t,description:a.target.value}),className:"w-full p-2 border rounded",rows:3,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[t.images.map((a,i)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"url",value:a,onChange:d=>z(i,d.target.value),className:"flex-1 p-2 border rounded",placeholder:"URL de la imagen",required:!0}),e.jsx("button",{type:"button",onClick:()=>K(i),className:"px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600","aria-label":"Eliminar imagen",children:e.jsx("i",{className:"fas fa-trash"})})]},i)),e.jsxs("button",{type:"button",onClick:G,className:"mt-2 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Agregar imagen"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[g&&e.jsx("button",{type:"button",onClick:()=>{n({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0}),p(null)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600",children:[g?"Actualizar":"Crear"," Producto"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Anime"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(a=>{var i,d;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:a.images[0],alt:a.name,className:"h-10 w-10 rounded-full object-cover"}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:["$",a.price.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800",children:(i=a.category_ref)==null?void 0:i.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:(d=a.anime)==null?void 0:d.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.stock})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>$(a),className:"text-indigo-600 hover:text-indigo-900 mr-4","aria-label":"Editar producto",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{onClick:()=>T(a.id),className:"text-red-600 hover:text-red-900","aria-label":"Eliminar producto",children:e.jsx("i",{className:"fas fa-trash"})})]})]},a.id)})})]})})]})]})}export{J as default};
