import{c as w,R as u,s as c,j as e,P as k,r as f,S as D}from"./index-Cbqca1ej.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=w("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=w("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function F(){const[j,y]=u.useState([]),[x,g]=u.useState(""),[N,h]=u.useState(null),[t,i]=u.useState(null);u.useEffect(()=>{l()},[]);async function l(){const{data:r,error:s}=await c.from("categories").select("*").order("name");if(s){i("Error al cargar categorías");return}y(r||[])}async function p(r){if(r.preventDefault(),i(null),!x.trim())return;const{error:s}=await c.from("categories").insert({name:x.trim()});if(s){i("Error al crear categoría");return}g(""),l()}async function b(r){const{error:s}=await c.from("categories").delete().eq("id",r);if(s){i("Error al eliminar categoría");return}l()}async function o(r,s){const{error:v}=await c.from("categories").update({name:s}).eq("id",r);if(v){i("Error al actualizar categoría");return}h(null),l()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Categorías"}),t&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:t}),e.jsxs("form",{onSubmit:p,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:r=>g(r.target.value),placeholder:"Nueva categoría",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:j.map(r=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[N===r.id?e.jsx("input",{type:"text",defaultValue:r.name,onBlur:s=>o(r.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&o(r.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:r.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(r.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar categoría",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>b(r.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar categoría",children:e.jsx(C,{className:"h-5 w-5"})})]})]},r.id))})]})}function M(){const[j,y]=u.useState([]),[x,g]=u.useState(""),[N,h]=u.useState(null),[t,i]=u.useState(null);u.useEffect(()=>{l()},[]);async function l(){const{data:r,error:s}=await c.from("anime").select("*").order("name");if(s){i("Error al cargar animes");return}y(r||[])}async function p(r){if(r.preventDefault(),i(null),!x.trim())return;const{error:s}=await c.from("anime").insert({name:x.trim()});if(s){i("Error al crear anime");return}g(""),l()}async function b(r){const{error:s}=await c.from("anime").delete().eq("id",r);if(s){i("Error al eliminar anime");return}l()}async function o(r,s){const{error:v}=await c.from("anime").update({name:s}).eq("id",r);if(v){i("Error al actualizar anime");return}h(null),l()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Animes"}),t&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:t}),e.jsxs("form",{onSubmit:p,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:r=>g(r.target.value),placeholder:"Nuevo anime",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:j.map(r=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[N===r.id?e.jsx("input",{type:"text",defaultValue:r.name,onBlur:s=>o(r.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&o(r.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:r.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(r.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar anime",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>b(r.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar anime",children:e.jsx(C,{className:"h-5 w-5"})})]})]},r.id))})]})}function z(){const[j,y]=f.useState([]),[x,g]=f.useState([]),[N,h]=f.useState([]),[t,i]=f.useState({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0}),[l,p]=f.useState(null),[b,o]=f.useState(null);f.useEffect(()=>{r(),s(),v()},[]);async function r(){const{data:a,error:n}=await c.from("products").select(`
        *,
        category_ref:categories(id, name),
        anime:anime(id, name)
      `).order("created_at",{ascending:!1});if(n){console.error("Error al cargar productos:",n),o("Error al cargar los productos");return}y(a||[])}async function s(){const{data:a}=await c.from("categories").select("*").order("name");g(a||[])}async function v(){const{data:a}=await c.from("anime").select("*").order("name");h(a||[])}async function S(a){a.preventDefault(),o(null);const n=parseFloat(t.price);if(isNaN(n)||n<0){o("Por favor, ingresa un precio válido");return}const d={name:t.name,price:n,category_id:t.category_id,anime_id:t.anime_id,description:t.description,images:t.images,stock:t.stock};try{if(l){const{error:m}=await c.from("products").update(d).eq("id",l);if(m)throw m}else{const{error:m}=await c.from("products").insert(d);if(m)throw m}i({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0}),p(null),r()}catch(m){console.error("Error:",m),o(m.message||"Ha ocurrido un error")}}async function _(a){if(confirm("¿Estás seguro de que quieres eliminar este producto?"))try{const{error:n}=await c.from("products").delete().eq("id",a);if(n)throw n;r()}catch(n){console.error("Error al eliminar:",n),o(n.message||"Error al eliminar el producto")}}function A(a){i({name:a.name,price:a.price.toString(),category_id:a.category_id||"",anime_id:a.anime_id||"",description:a.description,images:a.images,stock:a.stock||0}),p(a.id)}function P(a,n){const d=[...t.images];d[a]=n,i({...t,images:d})}function q(){i({...t,images:[...t.images,""]})}function I(a){const n=t.images.filter((d,m)=>m!==a);i({...t,images:n})}return e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Panel de Administración",description:"Panel de administración de GATOTAKU"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Panel de Administración"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsx(F,{}),e.jsx(M,{})]}),b&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded",children:b}),e.jsxs("form",{onSubmit:S,className:"bg-white p-6 rounded-lg shadow-md mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:l?"Editar Producto":"Nuevo Producto"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>i({...t,name:a.target.value}),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Precio"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"C$"})}),e.jsx("input",{type:"number",name:"price",step:"0.01",value:t.price,onChange:a=>i({...t,price:a.target.value}),className:"mt-1 block w-full pl-8 pr-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm"})]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Stock"}),e.jsx("input",{type:"number",name:"stock",value:t.stock,onChange:a=>i({...t,stock:parseInt(a.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsxs("select",{value:t.category_id,onChange:a=>i({...t,category_id:a.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Anime"}),e.jsxs("select",{value:t.anime_id,onChange:a=>i({...t,anime_id:a.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un anime"}),N.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:t.description,onChange:a=>i({...t,description:a.target.value}),className:"w-full p-2 border rounded",rows:3,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Imágenes"}),t.images.map((a,n)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"url",value:a,onChange:d=>P(n,d.target.value),className:"flex-1 p-2 border rounded",placeholder:"URL de la imagen",required:!0}),e.jsx("button",{type:"button",onClick:()=>I(n),className:"px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600","aria-label":"Eliminar imagen",children:e.jsx("i",{className:"fas fa-trash"})})]},n)),e.jsxs("button",{type:"button",onClick:q,className:"mt-2 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Agregar imagen"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[l&&e.jsx("button",{type:"button",onClick:()=>{i({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0}),p(null)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600",children:[l?"Actualizar":"Crear"," Producto"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Anime"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(a=>{var n,d;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:a.images[0],alt:a.name,className:"h-10 w-10 rounded-full object-cover"}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:["$",a.price.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800",children:(n=a.category_ref)==null?void 0:n.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:(d=a.anime)==null?void 0:d.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.stock})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>A(a),className:"text-indigo-600 hover:text-indigo-900 mr-4","aria-label":"Editar producto",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{onClick:()=>_(a.id),className:"text-red-600 hover:text-red-900","aria-label":"Eliminar producto",children:e.jsx("i",{className:"fas fa-trash"})})]})]},a.id)})})]})})]})]})}export{z as default};
