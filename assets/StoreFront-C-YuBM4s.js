import{r as d,j as e,t as T,R as L,S as z,E as D,v as O}from"./vendor-mA2QtIyM.js";import{u as _,s as S,S as B}from"./index-DRCfM75w.js";function M({onFilterChange:r,currentFilters:g={},categories:y,animes:f,onResetFilters:v}){const[h,l]=d.useState(g),[n,p]=d.useState(!1),w=a=>{const m={...g,...a,page:1};l(m),r(m)},P=a=>{w({category:a.target.value===""?void 0:a.target.value})},N=a=>{w({anime:a.target.value===""?void 0:a.target.value})},x=a=>{const m=a.target.value?parseFloat(a.target.value):void 0;w({minPrice:m})},b=a=>{const m=a.target.value?parseFloat(a.target.value):void 0;w({maxPrice:m})},F=a=>{const m=a.target.value;l(o=>({...o,search:m===""?void 0:m})),r({search:m===""?void 0:m})},E=()=>{p(!n)},C=()=>{const a={search:void 0,category:void 0,anime:void 0,minPrice:void 0,maxPrice:void 0,sortBy:"name_asc"};l(a),r(a),v&&v()};return e.jsxs("div",{className:"search-and-filters-container pt-4",children:[e.jsx("div",{className:"filter-group mb-4",children:e.jsx("input",{id:"search-input-desktop",type:"text",placeholder:"Buscar productos...",value:h.search||"",onChange:F,"aria-label":"Buscar productos por nombre o descripción",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"})}),e.jsx("div",{className:"md:hidden flex justify-end mb-4",children:e.jsxs("button",{onClick:E,className:"flex items-center px-4 py-2 bg-orange-500 text-white rounded-md",children:[e.jsx(T,{className:"mr-2"})," Filtros"]})}),e.jsxs("div",{className:`
        additional-filters
        grid grid-cols-1 
        ${n?"grid":"hidden"} 
        md:grid md:grid-cols-2 md:gap-4
      `,children:[e.jsxs("div",{className:"md:flex md:space-x-4 md:col-span-2",children:[e.jsxs("div",{className:"filter-group flex-1",children:[e.jsx("label",{htmlFor:"category-select",className:" my-2 block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsxs("select",{id:"category-select",value:h.category||"",onChange:P,"aria-label":"Seleccionar categoría de producto",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),y.sort((a,m)=>a.name.localeCompare(m.name)).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"filter-group flex-1 ",children:[e.jsx("label",{htmlFor:"anime-select",className:" my-2 block text-sm font-medium text-gray-700 mb-1",children:"Anime"}),e.jsxs("select",{id:"anime-select",value:h.anime||"",onChange:N,"aria-label":"Seleccionar anime",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"Todos los Animes"}),f.sort((a,m)=>a.name.localeCompare(m.name)).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"md:flex md:space-x-4 md:col-span-2 my-4",children:[e.jsx("div",{className:"filter-group flex-1",children:e.jsx("input",{id:"min-price-input",type:"number",placeholder:"Precio mínimo",value:h.minPrice!==void 0?h.minPrice:"",onChange:x,"aria-label":"Filtrar productos por precio mínimo",min:"0",step:"0.01",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"})}),e.jsx("div",{className:"filter-group flex-1",children:e.jsx("input",{id:"max-price-input",type:"number",placeholder:"Precio máximo",value:h.maxPrice!==void 0?h.maxPrice:"",onChange:b,"aria-label":"Filtrar productos por precio máximo",min:"0",step:"0.01",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"})})]}),e.jsx("div",{className:"filter-group col-span-full",children:e.jsx("button",{onClick:C,className:"w-full px-4 py-2 mt-4 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Restablecer Filtros"})})]})]})}function V(r){const g=[400,800,1200];return r.map(y=>g.map(f=>`${y} ${f}w`).join(", "))}function $(r,g={}){const{maxWidth:y=1200,quality:f=70,format:v="webp"}=g;let h=r;const l=[`w-${y}`,`q-${f}`,"fo-auto","cmpr-true",`f-${v}`];return r.includes("?")?h+=`&tr=${l.join(",")}`:h+=`?tr=${l.join(",")}`,h}function W(r){return`data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg' viewBox%3D'0 0 1 1'%3E%3Cfilter id%3D'blur' filterUnits%3D'userSpaceOnUse' color-interpolation-filters%3D'sRGB'%3E%3CfeGaussianBlur stdDeviation%3D'10'%2F%3E%3C%2Ffilter%3E%3Cimage x%3D'0' y%3D'0' width%3D'100%25' height%3D'100%25' preserveAspectRatio%3D'none' href%3D'${r}' filter%3D'url(%23blur)'%2F%3E%3C%2Fsvg%3E`}function q({images:r,alt:g,className:y="",imageRefs:f,onFullyLoaded:v,loading:h}){const l=L.useMemo(()=>!r||r.length===0?["https://via.placeholder.com/400x400?text=No+Image"]:r.map(t=>typeof t=="string"?$(t):typeof t=="object"&&t.src?{...t,src:$(t.src)}:t),[r]),[n,p]=d.useState(0),[w,P]=d.useState([]),N=d.useRef([]);d.useEffect(()=>{p(0)},[l]),d.useEffect(()=>{l.forEach(t=>{const i=new Image;i.src=typeof t=="string"?t:t.src})},[l]);const x=t=>{P(i=>i.includes(t)?i:[...i,t])},b=()=>{v&&v()},F=t=>{p(t)},E=()=>{p(t=>t===0?l.length-1:t-1)},C=()=>{p(t=>(t+1)%l.length)},[a,m]=d.useState(!1),o=t=>{p(t),m(!0)},s=()=>m(!1);return d.useEffect(()=>{f&&f(N.current)},[l,f]),e.jsxs("div",{className:`${y} relative w-full h-full overflow-hidden`,onClick:t=>t.stopPropagation(),children:[l.length>1&&e.jsx("button",{onClick:E,className:"absolute left-2 top-1/2 transform -translate-y-1/2 z-20 w-10 h-10 flex items-center justify-center",children:e.jsx("div",{className:"bg-orange-500/50 hover:bg-orange-600/60 rounded-full w-8 h-8 flex items-center justify-center shadow-lg transition-all duration-300",children:e.jsx("span",{className:"text-white text-xl font-bold transform -translate-x-0.5",children:"‹"})})}),a&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",onClick:s,children:e.jsxs("div",{className:"max-w-full max-h-full",children:[e.jsx("img",{src:typeof l[n]=="string"?l[n]:l[n].src,alt:`${g} - imagen ${n+1}`,className:"max-h-[90vh] max-w-[90vw] object-contain"}),e.jsxs("div",{className:"mt-4 flex justify-center space-x-4",children:[e.jsx("a",{href:typeof l[n]=="string"?l[n]:l[n].src,download:!0,className:"px-4 py-2 bg-white text-black rounded",onClick:t=>t.stopPropagation(),children:"Descargar"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),s()},className:"px-4 py-2 bg-white text-black rounded",children:"Cerrar"})]})]})}),l.length>1&&e.jsx("button",{onClick:C,className:"absolute right-2 top-1/2 transform -translate-y-1/2 z-20 w-10 h-10 flex items-center justify-center",children:e.jsx("div",{className:"bg-orange-500/50 hover:bg-orange-600/60 rounded-full w-8 h-8 flex items-center justify-center shadow-lg transition-all duration-300",children:e.jsx("span",{className:"text-white text-xl font-bold transform translate-x-0.5",children:"›"})})}),l.length>1&&e.jsxs("div",{className:"absolute bottom-2 right-2 z-20 bg-black/50 text-white px-2 py-1 rounded-full text-xs",children:[n+1," / ",l.length]}),e.jsx("div",{className:"absolute inset-0 grid grid-cols-1 grid-rows-1",children:l.map((t,i)=>{const c=typeof t=="string"?t:t.src,j=i===n,u=w.includes(i),I={loading:h??(j&&i===0?"eager":"lazy")};return e.jsxs("div",{className:`
                absolute inset-0 transition-opacity duration-300
                ${j?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}
              `,children:[e.jsxs("picture",{children:[typeof t=="object"&&t.webp&&e.jsx("source",{srcSet:t.webp,type:"image/webp"}),e.jsx("img",{ref:k=>{N.current[i]=k,k&&(j&&i===0?k.setAttribute("fetchpriority","high"):k.removeAttribute("fetchpriority"))},src:u?"https://via.placeholder.com/400x400?text=Image+Error":c,alt:`${g} - imagen ${i+1}`,srcSet:typeof t=="object"?t.srcSet:void 0,onError:()=>x(i),onLoad:()=>b(),className:"w-full h-full object-cover absolute inset-0 transform scale-100",...I})]}),e.jsxs("div",{className:"absolute bottom-3 left-3 z-30 flex space-x-2 md:hidden",children:[e.jsx("button",{onClick:()=>o(i),className:"bg-black/60 text-white px-3 py-1 rounded backdrop-blur-sm",children:"Ver"}),e.jsx("a",{href:u?"https://via.placeholder.com/400x400?text=Image+Error":c,download:!0,className:"bg-black/60 text-white px-3 py-1 rounded backdrop-blur-sm",children:"Descargar"})]})]},`${c}-${i}`)})}),l.length>1&&e.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-2",children:l.map((t,i)=>e.jsx("button",{onClick:()=>F(i),className:`
                w-2 h-2 rounded-full transition-colors duration-300
                ${i===n?"bg-orange-500":"bg-gray-300"}
              `},i))})]})}function G({product:r,className:g}){const{addItem:y}=_(),[f,v]=d.useState(0),[h,l]=d.useState(!1),n=d.useRef(null),p=d.useRef(null),w=L.useMemo(()=>{if(!r.images||r.images.length===0)return["https://via.placeholder.com/400x400?text=No+Image"];const x=r.images.filter(b=>b&&b.trim()!=="");return x.length>0?x:["https://via.placeholder.com/400x400?text=No+Image"]},[r.images]),P=L.useMemo(()=>w.map(x=>{const b=$(x);return{src:b,srcSet:V([b])[0],webp:$(x,{format:"webp",quality:70}),lowResSrc:W(b)}}),[w]),N=d.useCallback(()=>{n.current&&clearInterval(n.current),p.current&&clearTimeout(p.current),v(100),l(!0)},[]);return d.useEffect(()=>(v(0),l(!1),n.current=setInterval(()=>{v(x=>x<80?x+10:(clearInterval(n.current),x))},200),p.current=setTimeout(()=>{N()},5e3),()=>{n.current&&clearInterval(n.current),p.current&&clearTimeout(p.current)}),[r,N]),e.jsxs("div",{className:[g,"product-card bg-white border border-gray-200 rounded-xl overflow-hidden shadow-md hover:shadow-2xl flex flex-col h-full relative transition-all duration-300 hover:scale-[1.02] hover:-translate-y-2 group"].filter(Boolean).join(" "),children:[e.jsxs("div",{className:"w-full aspect-[4/5] sm:aspect-square overflow-hidden relative bg-gray-100",children:[e.jsx("div",{className:"absolute top-0 left-0 h-1 bg-orange-500 z-50 transition-all duration-300",style:{width:`${f}%`,opacity:h?0:1}}),e.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-50 blur-lg transition-opacity duration-300",style:{backgroundImage:`url(${P[0].lowResSrc})`,zIndex:10,opacity:h?0:.5}}),e.jsx(q,{images:P,alt:r.name,loading:"lazy",className:"w-full h-full relative z-20 transition-opacity duration-500",onFullyLoaded:N})]}),e.jsxs("div",{className:"bg-white p-3 sm:p-4 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-sm sm:text-base font-bold text-gray-900 line-clamp-2 leading-tight",children:r.name}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.category_ref&&e.jsx("span",{className:"bg-orange-100 text-orange-700 px-2 py-0.5 sm:px-2 sm:py-1 rounded text-xs font-medium",children:r.category_ref.name}),r.anime&&e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 sm:px-2 sm:py-1 rounded text-xs font-medium",children:r.anime.name})]}),e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-orange-600",children:["C$",r.price.toFixed(2)]}),e.jsx("p",{className:"text-xs sm:text-xs text-gray-600 line-clamp-2 leading-relaxed",children:r.description})]}),e.jsxs("button",{onClick:()=>y(r),className:"w-full bg-orange-500 text-white py-2 sm:py-2 px-3 sm:px-3 rounded-md flex items-center justify-center gap-2 hover:bg-orange-600 transition-all duration-200 font-medium text-sm shadow-sm hover:shadow-md mt-3","aria-label":`Agregar ${r.name} al carrito`,children:[e.jsx(z,{size:14,className:"sm:w-4 sm:h-4"}),e.jsx("span",{children:"Agregar"})]})]})]})}function U({error:r,resetErrorBoundary:g}){return d.useEffect(()=>{},[r]),e.jsxs("div",{role:"alert",className:"p-4 text-center bg-red-100",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Error Loading Store Front"}),e.jsx("p",{className:"text-red-500",children:r.message}),e.jsx("button",{onClick:g,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})}function Y(){return e.jsx(D,{FallbackComponent:U,onReset:()=>{window.history.go(0)},children:e.jsx("main",{className:"store-front",children:e.jsx(H,{})})})}function H(){var m;const[r,g]=d.useState(()=>({search:"",category:"",anime:"",sortBy:"name_asc",minPrice:void 0,maxPrice:void 0,page:1})),[y,f]=d.useState(!1);d.useEffect(()=>{const o=()=>{g({search:"",category:"",anime:"",minPrice:void 0,maxPrice:void 0,page:1})};return window.addEventListener("reset-store-filters",o),()=>{window.removeEventListener("reset-store-filters",o)}},[]);const v=d.useCallback(async()=>{var c,j;const[o,s]=await Promise.all([S.from("categories").select(`
          id, 
          name, 
          products:products(id)
        `),S.from("anime").select(`
          id, 
          name, 
          products:products(id)
        `)]),t=((c=o.data)==null?void 0:c.filter(u=>u.products.length>0).map(u=>({id:u.id,name:u.name})))||[],i=((j=s.data)==null?void 0:j.filter(u=>u.products.length>0).map(u=>({id:u.id,name:u.name})))||[];return{categoriesWithProducts:t,animesWithProducts:i}},[]),h=async o=>{try{const s=o.trim().toLowerCase(),t=[];t.push(`name.ilike.%${s}%`),t.push(`description.ilike.%${s}%`),t.push(`category.ilike.%${s}%`);const{data:i}=await S.from("anime").select("id").ilike("name",`%${s}%`).limit(1);return i&&i.length>0&&t.push(`anime_id.eq.${i[0].id}`),t.length>0?t.join(","):""}catch{return""}},l=d.useCallback(async({pageParam:o=1})=>{try{const t=(o-1)*12,i=t+12-1;let c=S.from("products").select("*, categories(id, name), anime(id, name)",{count:"exact"});if(r.search&&r.search.trim()!==""){const R=r.search.toLowerCase().trim();try{const A=await h(R);A&&(c=c.or(A))}catch{}}r.category&&r.category.trim()!==""&&(c=c.eq("category_id",r.category)),r.anime&&r.anime.trim()!==""&&(c=c.eq("anime_id",r.anime)),r.minPrice!==void 0&&(c=c.gte("price",r.minPrice)),r.maxPrice!==void 0&&(c=c.lte("price",r.maxPrice));const{data:j,error:u,count:I}=await c.range(t,i);if(u)throw u;const k=I?Math.ceil(I/12):0;return{products:j||[],totalPages:k}}catch{return{products:[],totalPages:0}}},[r]),{data:n,isLoading:p,error:w,isError:P,refetch:N}=O({queryKey:["products",r],queryFn:async()=>{const{categoriesWithProducts:o,animesWithProducts:s}=await v(),t=await l({pageParam:r.page||1});return{categoriesWithProducts:o,animesWithProducts:s,...t}},placeholderData:o=>o,staleTime:5e3,gcTime:1e4,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),x=d.useCallback(o=>{g(s=>({...s,...o}))},[]),b=o=>{f(!0),setTimeout(()=>{g(s=>({...s,page:o})),setTimeout(()=>{const s=document.querySelector(".products-grid-wrapper");if(s)s.scrollIntoView({behavior:"smooth",block:"start"});else{const t=document.getElementById("main-content");t&&t.scrollIntoView({behavior:"smooth",block:"start"})}setTimeout(()=>{f(!1)},300)},100)},150)},F=()=>{g({search:"",category:"",anime:"",minPrice:void 0,maxPrice:void 0,page:1})},[E,C]=d.useState(0);d.useEffect(()=>{let o=!1;const s=()=>{o||(requestAnimationFrame(()=>{const t=document.querySelector("footer"),i=window.innerHeight;if(t){const c=t.getBoundingClientRect();if(c.top<i){const j=i-c.top;C(j)}else C(0)}o=!1}),o=!0)};return s(),window.addEventListener("scroll",s,{passive:!0}),window.addEventListener("resize",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("resize",s)}},[]);const a=()=>{const o=(n==null?void 0:n.totalPages)||0,s=r.page||1;if(o<=1)return null;const i=s<=3?Array.from({length:Math.min(5,o)},(j,u)=>u+1):s>=o-2?Array.from({length:5},(j,u)=>o-5+u+1):[s-2,s-1,s,s+1,s+2];return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 flex justify-center items-center py-2 z-50 bg-white/95 backdrop-blur-sm transition-transform duration-200 ease-out shadow-lg border-t border-gray-200",style:{transform:`translateY(-${E}px)`},children:e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsxs("span",{className:"hidden md:block text-xs text-gray-500 mr-2",children:[s,"/",o]}),e.jsx("button",{onClick:()=>b(s-1),disabled:s===1,className:"w-8 h-8 sm:w-9 sm:h-9 rounded-md bg-gray-100 hover:bg-orange-100 disabled:opacity-50 transition-colors flex items-center justify-center text-sm",children:"←"}),i.map(c=>e.jsx("button",{onClick:()=>b(c),className:`w-8 h-8 sm:w-9 sm:h-9 rounded-md transition-colors flex items-center justify-center text-sm font-medium ${s===c?"bg-orange-500 text-white shadow-sm":"bg-gray-100 hover:bg-orange-100 text-gray-700"}`,children:c},c)),e.jsx("button",{onClick:()=>b(s+1),disabled:s===o,className:"w-8 h-8 sm:w-9 sm:h-9 rounded-md bg-gray-100 hover:bg-orange-100 disabled:opacity-50 transition-colors flex items-center justify-center text-sm",children:"→"})]})})};return e.jsx("div",{className:"relative min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 overflow-hidden",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10",children:[e.jsx(B,{title:"GATOTAKU - Tu Tienda de Anime",description:"Descubre nuestra colección de productos de anime. Figuras, accesorios y más."}),e.jsx("div",{className:"mb-6 bg-white rounded-xl shadow-lg p-4 border border-gray-200",children:p?e.jsx("h1",{className:"text-3xl font-bold text-gray-800 border-b-2 border-orange-200 pb-2",children:"GATOTAKU"}):e.jsx(M,{onFilterChange:x,currentFilters:r,categories:(n==null?void 0:n.categoriesWithProducts)||[],animes:(n==null?void 0:n.animesWithProducts)||[],onResetFilters:F})}),e.jsxs("div",{id:"products-section",className:"relative products-grid-wrapper",children:[y&&e.jsx("div",{className:"absolute inset-0 bg-white/70 backdrop-blur-sm z-10 flex items-center justify-center rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-orange-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-orange-600 border-t-transparent"}),e.jsx("span",{className:"text-sm font-medium",children:"Cargando..."})]})}),e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-4 sm:gap-4 md:gap-6 transition-opacity duration-300 ${y?"opacity-50":"opacity-100"}`,children:(m=n==null?void 0:n.products)==null?void 0:m.map((o,s)=>e.jsx("div",{className:"transition-all duration-300",style:{transitionDelay:`${s*50}ms`,willChange:"transform, opacity"},children:e.jsx(G,{product:o})},o.id))})]}),a()]})})}export{Y as default};
