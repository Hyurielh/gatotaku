import{r as g,j as e,k as j,S as N,E as w,D as C,G as v}from"./vendor-9578a473.js";import{a as F,s as f,S as P}from"./index-f74bd664.js";import{I as k}from"./ImageCarousel-e1fa7f5e.js";function S(a){return(Array.isArray(a)?a:[a]).filter(l=>l&&l.trim()!=="").map(l=>{try{return[{descriptor:"320w",width:320},{descriptor:"640w",width:640},{descriptor:"1024w",width:1024},{descriptor:"1920w",width:1920}].map(n=>`${l} ${n.descriptor}`).join(", ")}catch(t){return console.error("Error generating WebP srcset:",t),l}})}function _({onFilterChange:a,currentFilters:c={},categories:d,animes:l}){const[t,n]=g.useState(c),m=r=>{const i={...t,...r};n(i),a(i)},h=r=>{m({search:r.target.value})},x=r=>{m({category:r.target.value===""?void 0:r.target.value})},p=r=>{m({anime:r.target.value===""?void 0:r.target.value})},b=r=>{const i=r.target.value?parseFloat(r.target.value):void 0;m({minPrice:i})},s=r=>{const i=r.target.value?parseFloat(r.target.value):void 0;m({maxPrice:i})},u=r=>{m({sortBy:r.target.value})},o=()=>{n({}),a({})};return e.jsxs("div",{className:"search-and-filters grid grid-cols-1 md:grid-cols-3 gap-4","aria-label":"Filtros de búsqueda",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"search-input",className:"block text-sm font-medium text-gray-700",children:"Buscar productos"}),e.jsx("input",{id:"search-input",type:"text",placeholder:"Buscar productos...",value:t.search||"",onChange:h,"aria-label":"Buscar productos por nombre o descripción",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"category-select",className:"block text-sm font-medium text-gray-700",children:"Categoría"}),e.jsxs("select",{id:"category-select",value:t.category||"",onChange:x,"aria-label":"Seleccionar categoría de producto",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),d.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"anime-select",className:"block text-sm font-medium text-gray-700",children:"Anime"}),e.jsxs("select",{id:"anime-select",value:t.anime||"",onChange:p,"aria-label":"Seleccionar anime",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Todos los Animes"}),l.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"min-price-input",className:"block text-sm font-medium text-gray-700",children:"Precio Mínimo"}),e.jsx("input",{id:"min-price-input",type:"number",placeholder:"Precio mínimo",value:t.minPrice||"",onChange:b,"aria-label":"Filtrar productos por precio mínimo",min:"0",step:"0.01",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"max-price-input",className:"block text-sm font-medium text-gray-700",children:"Precio Máximo"}),e.jsx("input",{id:"max-price-input",type:"number",placeholder:"Precio máximo",value:t.maxPrice||"",onChange:s,"aria-label":"Filtrar productos por precio máximo",min:"0",step:"0.01",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"sort-select",className:"block text-sm font-medium text-gray-700",children:"Ordenar por"}),e.jsxs("select",{id:"sort-select",value:t.sortBy||"name_asc",onChange:u,"aria-label":"Ordenar productos",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"name_asc",children:"Nombre A-Z"}),e.jsx("option",{value:"name_desc",children:"Nombre Z-A"}),e.jsx("option",{value:"price_asc",children:"Precio: Menor a Mayor"}),e.jsx("option",{value:"price_desc",children:"Precio: Mayor a Menor"})]})]}),Object.keys(t).length>0&&e.jsx("div",{className:"col-span-full",children:e.jsx("button",{onClick:o,"aria-label":"Restablecer filtros",className:"w-full p-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"Restablecer Filtros"})})]})}function E({product:a}){const{addItem:c}=F(),d=j.useMemo(()=>{if(!a.images||a.images.length===0)return["https://via.placeholder.com/400x400?text=No+Image"];const t=a.images.filter(n=>n&&n.trim()!=="");return t.length>0?t:["https://via.placeholder.com/400x400?text=No+Image"]},[a.images]),l=j.useMemo(()=>S(d),[d]);return e.jsxs("div",{className:"product-card border rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300",children:[e.jsx("div",{className:"w-full h-64 md:h-80",children:e.jsx(k,{images:d,alt:a.name,srcSet:l.join(", "),loading:"lazy"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a.name}),e.jsxs("div",{className:"flex gap-2 text-sm text-orange-500 mb-2",children:[a.category_ref&&e.jsx("span",{children:a.category_ref.name}),a.anime&&e.jsxs("span",{children:["• ",a.anime.name]})]}),e.jsxs("span",{className:"text-xl font-bold text-orange-500 block mb-2",children:["C$",a.price.toFixed(2)]}),e.jsx("p",{className:"text-gray-600 mb-4",children:a.description}),e.jsxs("button",{onClick:()=>c(a),className:"w-full bg-black text-white py-2 px-4 rounded-md hover:bg-gray-900 transition-colors flex items-center justify-center gap-2","aria-label":`Agregar ${a.name} al carrito`,children:[e.jsx(N,{size:20}),"Agregar al carrito"]})]})})]})}function A({error:a,resetErrorBoundary:c}){return g.useEffect(()=>{console.error("StoreFront Component Error:",a)},[a]),e.jsxs("div",{role:"alert",className:"p-4 text-center bg-red-100",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Error Loading Store Front"}),e.jsx("p",{className:"text-red-500",children:a.message}),e.jsx("button",{onClick:c,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})}function B(){return e.jsx(w,{FallbackComponent:A,onReset:()=>{window.location.reload()},children:e.jsx(T,{})})}function T(){const[a,c]=g.useState(()=>({search:"",category:"",anime:"",sortBy:"name_asc"})),d=g.useCallback(async({pageParam:s=1})=>{try{let o=f.from("products").select(`
          *,
          category_ref:categories(id, name),
          anime:anime(id, name)
        `,{count:"exact"}).range((s-1)*50,s*50-1);switch(a.category&&(o=o.eq("category_id",a.category)),a.anime&&(o=o.eq("anime_id",a.anime)),a.search&&(o=o.ilike("name",`%${a.search}%`)),a.sortBy){case"name_asc":o=o.order("name",{ascending:!0});break;case"price_asc":o=o.order("price",{ascending:!0});break;case"price_desc":o=o.order("price",{ascending:!1});break;default:o=o.order("created_at",{ascending:!1})}const{data:r,error:i,count:y}=await o;if(i)throw i;return{products:r||[],nextPage:r&&r.length===50?s+1:void 0,totalCount:y}}catch(u){throw console.error("Failed to fetch products:",u),u}},[a]),l=g.useCallback(s=>{c(u=>({...u,...s}))},[]),{data:t,fetchNextPage:n,hasNextPage:m,isFetching:h}=C(["products",a],d,{getNextPageParam:s=>s.nextPage,keepPreviousData:!0,staleTime:5*60*1e3,cacheTime:30*60*1e3}),{data:x}=v("categories",async()=>{const{data:s}=await f.from("categories").select("*").order("name");return s||[]},{staleTime:1*60*60*1e3,cacheTime:24*60*60*1e3}),{data:p}=v("animes",async()=>{const{data:s}=await f.from("anime").select("*").order("name");return s||[]},{staleTime:1*60*60*1e3,cacheTime:24*60*60*1e3}),b=g.useMemo(()=>(t==null?void 0:t.pages.flatMap(s=>s.products))||[],[t]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx(P,{title:"GATOTAKU - Tu Tienda de Anime",description:"Descubre nuestra colección de productos de anime. Figuras, mangas, accesorios y más."}),e.jsx(_,{categories:x||[],animes:p||[],currentFilters:a,onFilterChange:l}),e.jsx("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:b.map(s=>e.jsx(E,{product:s},s.id))}),m&&e.jsx("button",{disabled:h,onClick:()=>n(),className:"bg-orange-500 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded",children:h?"Cargando...":"Cargar más"})]})}export{B as default};
