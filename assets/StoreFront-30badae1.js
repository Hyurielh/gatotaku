import{r as x,j as e,k as y,S as F,D as N,X as w,M as _,P as E,E as S,G as C,I as A}from"./vendor-15d52b21.js";import{a as k,s as j,S as M}from"./index-538900c3.js";import{I as $}from"./ImageCarousel-68d2f05f.js";function I(a){return(Array.isArray(a)?a:[a]).filter(n=>n&&n.trim()!=="").map(n=>{try{return[{descriptor:"320w",width:320},{descriptor:"640w",width:640},{descriptor:"1024w",width:1024},{descriptor:"1920w",width:1920}].map(o=>`${n} ${o.descriptor}`).join(", ")}catch(l){return console.error("Error generating WebP srcset:",l),n}})}function T({onFilterChange:a,currentFilters:d={},categories:c,animes:n}){const[l,o]=x.useState(d),m=r=>{const s={...l,...r};o(s),a(s)},u=r=>{m({search:r.target.value})},i=r=>{m({category:r.target.value===""?void 0:r.target.value})},p=r=>{m({anime:r.target.value===""?void 0:r.target.value})},g=r=>{const s=r.target.value?parseFloat(r.target.value):void 0;m({minPrice:s})},h=r=>{const s=r.target.value?parseFloat(r.target.value):void 0;m({maxPrice:s})},b=r=>{m({sortBy:r.target.value})},t=()=>{o({}),a({})};return e.jsxs("div",{className:"search-and-filters grid grid-cols-1 md:grid-cols-3 gap-4","aria-label":"Filtros de búsqueda",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"search-input",className:"block text-sm font-medium text-gray-700",children:"Buscar productos"}),e.jsx("input",{id:"search-input",type:"text",placeholder:"Buscar productos...",value:l.search||"",onChange:u,"aria-label":"Buscar productos por nombre o descripción",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"category-select",className:"block text-sm font-medium text-gray-700",children:"Categoría"}),e.jsxs("select",{id:"category-select",value:l.category||"",onChange:i,"aria-label":"Seleccionar categoría de producto",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),c.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"anime-select",className:"block text-sm font-medium text-gray-700",children:"Anime"}),e.jsxs("select",{id:"anime-select",value:l.anime||"",onChange:p,"aria-label":"Seleccionar anime",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Todos los Animes"}),n.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"min-price-input",className:"block text-sm font-medium text-gray-700",children:"Precio Mínimo"}),e.jsx("input",{id:"min-price-input",type:"number",placeholder:"Precio mínimo",value:l.minPrice||"",onChange:g,"aria-label":"Filtrar productos por precio mínimo",min:"0",step:"0.01",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"max-price-input",className:"block text-sm font-medium text-gray-700",children:"Precio Máximo"}),e.jsx("input",{id:"max-price-input",type:"number",placeholder:"Precio máximo",value:l.maxPrice,onChange:h,"aria-label":"Filtrar productos por precio máximo",min:"0",step:"0.01",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"sort-select",className:"block text-sm font-medium text-gray-700",children:"Ordenar por"}),e.jsxs("select",{id:"sort-select",value:l.sortBy||"name_asc",onChange:b,"aria-label":"Ordenar productos",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"name_asc",children:"Nombre A-Z"}),e.jsx("option",{value:"name_desc",children:"Nombre Z-A"}),e.jsx("option",{value:"price_asc",children:"Precio: Menor a Mayor"}),e.jsx("option",{value:"price_desc",children:"Precio: Mayor a Menor"})]})]}),Object.keys(l).length>0&&e.jsx("div",{className:"col-span-full",children:e.jsx("button",{onClick:t,"aria-label":"Restablecer filtros",className:"w-full p-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors",children:"Restablecer Filtros"})})]})}function R({product:a}){const{addItem:d}=k(),c=y.useMemo(()=>{if(!a.images||a.images.length===0)return["https://via.placeholder.com/400x400?text=No+Image"];const l=a.images.filter(o=>o&&o.trim()!=="");return l.length>0?l:["https://via.placeholder.com/400x400?text=No+Image"]},[a.images]),n=y.useMemo(()=>I(c),[c]);return e.jsxs("div",{className:"product-card border rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300",children:[e.jsx("div",{className:"w-full h-64 md:h-80",children:e.jsx($,{images:c,alt:a.name,srcSet:n.join(", "),loading:"lazy"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a.name}),e.jsxs("div",{className:"flex gap-2 text-sm text-orange-500 mb-2",children:[a.category_ref&&e.jsx("span",{children:a.category_ref.name}),a.anime&&e.jsxs("span",{children:["• ",a.anime.name]})]}),e.jsxs("span",{className:"text-xl font-bold text-orange-500 block mb-2",children:["C$",a.price.toFixed(2)]}),e.jsx("p",{className:"text-gray-600 mb-4",children:a.description}),e.jsxs("button",{onClick:()=>d(a),className:"w-full bg-black text-white py-2 px-4 rounded-md hover:bg-gray-900 transition-colors flex items-center justify-center gap-2","aria-label":`Agregar ${a.name} al carrito`,children:[e.jsx(F,{size:20}),"Agregar al carrito"]})]})})]})}function z(){const{items:a,removeItem:d,updateQuantity:c,total:n,isOpen:l,setIsOpen:o,clearCart:m}=k(),u=()=>{const i=a.map(h=>`• ${h.quantity}x ${h.product.name} - C$${(h.product.price*h.quantity).toFixed(2)}`).join(`
`),p=`

Total: C$${n.toFixed(2)}`,g=encodeURIComponent(`¡Hola! Me gustaría ordenar:
${i}${p}`);window.open(`https://wa.me/50578364365?text=${g}`,"_blank"),m()};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(!0),className:"fixed bottom-4 right-4 z-50 bg-black text-white p-3 rounded-full shadow-lg hover:bg-gray-900 transition-colors","aria-label":"Abrir carrito",children:e.jsxs("div",{className:"relative",children:[e.jsx(N,{size:24}),a.length>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center",children:a.length})]})}),l&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>o(!1)}),e.jsx("div",{className:"fixed inset-y-0 right-0 max-w-full flex",children:e.jsx("div",{className:"w-screen max-w-md",children:e.jsxs("div",{className:"h-full flex flex-col bg-white shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[e.jsx(N,{className:"mr-2"}),"Carrito de Compras"]}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-full","aria-label":"Cerrar carrito",children:e.jsx(w,{})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"El carrito está vacío"}):e.jsx("ul",{className:"space-y-4",children:a.map(i=>e.jsxs("li",{className:"flex items-center space-x-4 bg-white rounded-lg p-2 shadow-sm",children:[e.jsx("img",{src:i.product.images[0]||"https://via.placeholder.com/100",alt:i.product.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:i.product.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["C$",i.product.price.toFixed(2)]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("button",{onClick:()=>c(i.product.id,i.quantity-1),className:"p-1 hover:bg-gray-100 rounded","aria-label":"Reducir cantidad",children:e.jsx(_,{size:16})}),e.jsx("span",{className:"w-8 text-center",children:i.quantity}),e.jsx("button",{onClick:()=>c(i.product.id,i.quantity+1),className:"p-1 hover:bg-gray-100 rounded","aria-label":"Aumentar cantidad",children:e.jsx(E,{size:16})})]})]}),e.jsx("button",{onClick:()=>d(i.product.id),className:"p-2 hover:bg-gray-100 rounded-full flex-shrink-0","aria-label":"Eliminar del carrito",children:e.jsx(w,{size:20})})]},i.product.id))})}),a.length>0&&e.jsxs("div",{className:"border-t p-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center font-semibold mb-4",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["C$",n.toFixed(2)]})]}),e.jsx("button",{onClick:u,className:"w-full bg-black text-white py-3 px-4 rounded-lg hover:bg-gray-900 transition-colors",children:"Ordenar por WhatsApp"})]})]})})})]})]})}function q({error:a,resetErrorBoundary:d}){return x.useEffect(()=>{console.error("StoreFront Component Error:",a)},[a]),e.jsxs("div",{role:"alert",className:"p-4 text-center bg-red-100",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Error Loading Store Front"}),e.jsx("p",{className:"text-red-500",children:a.message}),e.jsx("button",{onClick:d,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})}function Q(){return e.jsx(S,{FallbackComponent:q,onReset:()=>{window.location.reload()},children:e.jsx(B,{})})}function B(){const[a,d]=x.useState(()=>({search:"",category:"",anime:"",sortBy:"name_asc",minPrice:0,maxPrice:void 0})),c=x.useCallback(async()=>{const{data:t}=await j.from("categories").select(`
        id, 
        name, 
        products:products(id)
      `);return(t==null?void 0:t.filter(r=>r.products.length>0).map(r=>({id:r.id,name:r.name})))||[]},[]),n=x.useCallback(async()=>{const{data:t}=await j.from("anime").select(`
        id, 
        name, 
        products:products(id)
      `);return(t==null?void 0:t.filter(r=>r.products.length>0).map(r=>({id:r.id,name:r.name})))||[]},[]),l=x.useCallback(async({pageParam:t=1})=>{try{let s=j.from("products").select(`
          *,
          category_ref:categories(id, name),
          anime:anime(id, name)
        `,{count:"exact"}).range((t-1)*5,t*5-1);switch(a.search&&(s=s.or(`
          ilike(name, "%${a.search}%"),
          ilike(description, "%${a.search}%"),
          ilike(category_ref.name, "%${a.search}%"),
          ilike(anime.name, "%${a.search}%")
        `)),a.category&&(s=s.eq("category_id",a.category)),a.anime&&(s=s.eq("anime_id",a.anime)),a.minPrice!==void 0&&(s=s.gte("price",a.minPrice)),a.maxPrice!==void 0&&(s=s.lte("price",a.maxPrice)),a.sortBy){case"name_asc":s=s.order("name",{ascending:!0});break;case"name_desc":s=s.order("name",{ascending:!1});break;case"price_asc":s=s.order("price",{ascending:!0});break;case"price_desc":s=s.order("price",{ascending:!1});break;default:s=s.order("created_at",{ascending:!1})}const{data:f,error:v,count:P}=await s;if(v)throw v;return{products:f||[],nextPage:f&&f.length===5?t+1:void 0,totalCount:P}}catch(r){throw console.error("Failed to fetch products:",r),r}},[a]),{data:o}=C("categoriesWithProducts",c),{data:m}=C("animesWithProducts",n),{data:u,fetchNextPage:i,hasNextPage:p,isFetchingNextPage:g}=A(["products",a],l,{getNextPageParam:t=>t.nextPage,keepPreviousData:!0}),h=x.useCallback(t=>{d(r=>({...r,...t}))},[]),b=x.useMemo(()=>(u==null?void 0:u.pages.flatMap(t=>t.products))||[],[u]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx(M,{title:"GATOTAKU - Tu Tienda de Anime",description:"Descubre nuestra colección de productos de anime. Figuras, mangas, accesorios y más."}),e.jsx(T,{categories:o||[],animes:m||[],currentFilters:a,onFilterChange:h}),e.jsx("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:b.map(t=>e.jsx(R,{product:t},t.id))}),p&&e.jsx("button",{disabled:g,onClick:()=>i(),className:"bg-orange-500 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded",children:g?"Cargando...":"Cargar más"}),e.jsx(z,{})]})}export{Q as default};
