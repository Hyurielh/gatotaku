import{r as p,j as e,k as C,S as M,D as F,X as k,M as _,P as E,E as T,G as B}from"./vendor-2e0792b2.js";import{a as $,s as N,S as O}from"./index-9f5d5cbc.js";import{I as R}from"./ImageCarousel-a57e97b1.js";function W(r){return(Array.isArray(r)?r:[r]).filter(c=>c&&c.trim()!=="").map(c=>{try{return[{descriptor:"320w",width:320},{descriptor:"640w",width:640},{descriptor:"1024w",width:1024},{descriptor:"1920w",width:1920}].map(a=>`${c} ${a.descriptor}`).join(", ")}catch(m){return console.error("Error generating WebP srcset:",m),c}})}function z({onFilterChange:r,currentFilters:l={},categories:h,animes:c,onResetFilters:m}){const[a,x]=p.useState(l),u=s=>{const t={...l,...s};x(t),r(t)},n=s=>{u({category:s.target.value===""?void 0:s.target.value})},b=s=>{u({anime:s.target.value===""?void 0:s.target.value})},f=s=>{const t=s.target.value?parseFloat(s.target.value):void 0;u({minPrice:t})},g=s=>{const t=s.target.value?parseFloat(s.target.value):void 0;u({maxPrice:t})},w=s=>{u({sortBy:s.target.value})},P=s=>{const t=s.target.value;x(o=>({...o,search:t===""?void 0:t})),r({search:t===""?void 0:t})},i=()=>{const s={search:void 0,category:void 0,anime:void 0,minPrice:void 0,maxPrice:void 0,sortBy:"name_asc"};x(s),r(s),m&&m()};return e.jsxs("div",{className:"search-and-filters grid grid-cols-1 md:grid-cols-3 gap-4","aria-label":"Filtros de búsqueda",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"search-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar productos"}),e.jsx("input",{id:"search-input",type:"text",placeholder:"Buscar productos...",value:a.search||"",onChange:P,"aria-label":"Buscar productos por nombre o descripción",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"category-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsxs("select",{id:"category-select",value:a.category||"",onChange:n,"aria-label":"Seleccionar categoría de producto",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"Todas las categorías"}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"anime-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Anime"}),e.jsxs("select",{id:"anime-select",value:a.anime||"",onChange:b,"aria-label":"Seleccionar anime",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"Todos los Animes"}),c.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"min-price-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Mínimo"}),e.jsx("input",{id:"min-price-input",type:"number",placeholder:"Precio mínimo",value:a.minPrice!==void 0?a.minPrice:"",onChange:f,"aria-label":"Filtrar productos por precio mínimo",min:"0",step:"0.01",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"max-price-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"Precio Máximo"}),e.jsx("input",{id:"max-price-input",type:"number",placeholder:"Precio máximo",value:a.maxPrice!==void 0?a.maxPrice:"",onChange:g,"aria-label":"Filtrar productos por precio máximo",min:"0",step:"0.01",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"sort-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordenar por"}),e.jsxs("select",{id:"sort-select",value:a.sortBy||"name_asc",onChange:w,"aria-label":"Ordenar productos",className:"block w-full p-2 border border-gray-300 rounded-md focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"name_asc",children:"Nombre A-Z"}),e.jsx("option",{value:"name_desc",children:"Nombre Z-A"}),e.jsx("option",{value:"price_asc",children:"Precio: Menor a Mayor"}),e.jsx("option",{value:"price_desc",children:"Precio: Mayor a Menor"})]})]}),e.jsx("div",{className:"filter-group col-span-full flex justify-center mt-4",children:e.jsx("button",{onClick:i,className:"bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition-colors",children:"Restablecer Filtros"})})]})}function I({product:r,className:l}){const{addItem:h}=$(),c=C.useMemo(()=>{if(!r.images||r.images.length===0)return["https://via.placeholder.com/400x400?text=No+Image"];const a=r.images.filter(x=>x&&x.trim()!=="");return a.length>0?a:["https://via.placeholder.com/400x400?text=No+Image"]},[r.images]),m=C.useMemo(()=>W(c),[c]);return e.jsxs("div",{className:[l,"product-card border rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col h-full"].filter(Boolean).join(" "),children:[e.jsx("div",{className:"w-full aspect-square",children:e.jsx("div",{className:"w-full h-full object-cover",children:e.jsx(R,{images:c,alt:r.name,srcSet:m.join(", "),loading:"lazy"})})}),e.jsxs("div",{className:"p-3 flex-grow flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-1",children:r.name}),e.jsxs("div",{className:"flex gap-1 text-xs text-orange-500 mb-1",children:[r.category_ref&&e.jsx("span",{children:r.category_ref.name}),r.anime&&e.jsxs("span",{children:["• ",r.anime.name]})]}),e.jsxs("span",{className:"text-lg font-bold text-orange-500 block mb-1",children:["C$",r.price.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:r.description})]}),e.jsxs("button",{onClick:()=>h(r),className:"w-full bg-black text-white py-1 px-2 rounded-md hover:bg-gray-900 transition-colors flex items-center justify-center gap-1 text-xs","aria-label":`Agregar ${r.name} al carrito`,children:[e.jsx(M,{size:16}),"Agregar"]})]})]})}function q(){const{items:r,removeItem:l,updateQuantity:h,total:c,isOpen:m,setIsOpen:a,clearCart:x}=$(),u=()=>{const n=r.map(g=>`• ${g.quantity}x ${g.product.name} - C$${(g.product.price*g.quantity).toFixed(2)}`).join(`
`),b=`

Total: C$${c.toFixed(2)}`,f=encodeURIComponent(`¡Hola! Me gustaría ordenar:
${n}${b}`);window.open(`https://wa.me/50578364365?text=${f}`,"_blank"),x()};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(!0),className:"fixed bottom-4 right-4 z-50 bg-black text-white p-3 rounded-full shadow-lg hover:bg-gray-900 transition-colors","aria-label":"Abrir carrito",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{size:24}),r.length>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center",children:r.length})]})}),m&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>a(!1)}),e.jsx("div",{className:"fixed inset-y-0 right-0 max-w-full flex",children:e.jsx("div",{className:"w-screen max-w-md",children:e.jsxs("div",{className:"h-full flex flex-col bg-white shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[e.jsx(F,{className:"mr-2"}),"Carrito de Compras"]}),e.jsx("button",{onClick:()=>a(!1),className:"p-2 hover:bg-gray-100 rounded-full","aria-label":"Cerrar carrito",children:e.jsx(k,{})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"El carrito está vacío"}):e.jsx("ul",{className:"space-y-4",children:r.map(n=>e.jsxs("li",{className:"flex items-center space-x-4 bg-white rounded-lg p-2 shadow-sm",children:[e.jsx("img",{src:n.product.images[0]||"https://via.placeholder.com/100",alt:n.product.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium truncate",children:n.product.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["C$",n.product.price.toFixed(2)]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("button",{onClick:()=>h(n.product.id,n.quantity-1),className:"p-1 hover:bg-gray-100 rounded","aria-label":"Reducir cantidad",children:e.jsx(_,{size:16})}),e.jsx("span",{className:"w-8 text-center",children:n.quantity}),e.jsx("button",{onClick:()=>h(n.product.id,n.quantity+1),className:"p-1 hover:bg-gray-100 rounded","aria-label":"Aumentar cantidad",children:e.jsx(E,{size:16})})]})]}),e.jsx("button",{onClick:()=>l(n.product.id),className:"p-2 hover:bg-gray-100 rounded-full flex-shrink-0","aria-label":"Eliminar del carrito",children:e.jsx(k,{size:20})})]},n.product.id))})}),r.length>0&&e.jsxs("div",{className:"border-t p-4 bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center font-semibold mb-4",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["C$",c.toFixed(2)]})]}),e.jsx("button",{onClick:u,className:"w-full bg-black text-white py-3 px-4 rounded-lg hover:bg-gray-900 transition-colors",children:"Ordenar por WhatsApp"})]})]})})})]})]})}function L({error:r,resetErrorBoundary:l}){return p.useEffect(()=>{console.error("StoreFront Component Error:",r)},[r]),e.jsxs("div",{role:"alert",className:"p-4 text-center bg-red-100",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Error Loading Store Front"}),e.jsx("p",{className:"text-red-500",children:r.message}),e.jsx("button",{onClick:l,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]})}function Z(){return e.jsx(T,{FallbackComponent:L,onReset:()=>{window.history.go(0)},children:e.jsx(G,{})})}function G(){const[r,l]=p.useState(()=>({search:"",category:"",anime:"",sortBy:"name_asc",minPrice:void 0,maxPrice:void 0,page:1})),h=p.useCallback(async()=>{var v,j;const[i,s]=await Promise.all([N.from("categories").select(`
          id, 
          name, 
          products:products(id)
        `),N.from("anime").select(`
          id, 
          name, 
          products:products(id)
        `)]),t=((v=i.data)==null?void 0:v.filter(d=>d.products.length>0).map(d=>({id:d.id,name:d.name})))||[],o=((j=s.data)==null?void 0:j.filter(d=>d.products.length>0).map(d=>({id:d.id,name:d.name})))||[];return{categoriesWithProducts:t,animesWithProducts:o}},[]),c=async i=>{try{const s=i.trim().toLowerCase(),t=[];t.push(`name.ilike.%${s}%`),t.push(`description.ilike.%${s}%`),t.push(`category.ilike.%${s}%`);const{data:o}=await N.from("anime").select("id").ilike("name",`%${s}%`).limit(1);return o&&o.length>0&&t.push(`anime_id.eq.${o[0].id}`),t.length>0?t.join(","):""}catch(s){return console.error("Error en búsqueda flexible:",s),""}},m=p.useCallback(async({pageParam:i=1})=>{try{console.log("🔍 Fetching Products with Filters:",r),console.log("Price Range:",{minPrice:r.minPrice,maxPrice:r.maxPrice});const s=(i-1)*12,t=s+12-1;let o=N.from("products").select("*, categories(id, name), anime(id, name)",{count:"exact"});if(r.search&&r.search.trim()!==""){const S=r.search.toLowerCase().trim();try{const y=await c(S);y&&(o=o.or(y))}catch(y){console.error("Error en búsqueda de productos:",y)}}r.category&&r.category.trim()!==""&&(o=o.eq("category_id",r.category)),r.anime&&r.anime.trim()!==""&&(o=o.eq("anime_id",r.anime)),r.minPrice!==void 0&&(console.log(`🏷️ Filtering products with price >= ${r.minPrice}`),o=o.gte("price",r.minPrice)),r.maxPrice!==void 0&&(console.log(`🏷️ Filtering products with price <= ${r.maxPrice}`),o=o.lte("price",r.maxPrice)),o=o.order(r.sortBy.split("_")[0],{ascending:r.sortBy.endsWith("_asc")});const{data:v,error:j,count:d}=await o.range(s,t);if(j)throw j;const A=d?Math.ceil(d/12):0;return{products:v||[],totalPages:A}}catch(s){return console.error("🚨 Error en búsqueda de productos:",s),{products:[],totalPages:0}}},[r]),{data:a,refetch:x,isLoading:u,error:n}=B(["storefront-data",r],async()=>{const{categoriesWithProducts:i,animesWithProducts:s}=await h(),t=await m({pageParam:r.page||1});return{categoriesWithProducts:i,animesWithProducts:s,...t}},{keepPreviousData:!0,staleTime:5e3,cacheTime:1e4,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),b=p.useCallback(i=>{l(s=>({...s,...i}))},[]),f=i=>{l(s=>({...s,page:i}))},g=()=>{l({search:"",category:"",anime:"",sortBy:"name_asc",minPrice:void 0,maxPrice:void 0,page:1})},w=()=>u?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-orange-500"})}):n?e.jsx("div",{className:"text-center text-red-500 py-8",children:"Error al cargar productos"}):a!=null&&a.products.length?e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4
                    gap-2 sm:gap-3 md:gap-4 
                    w-full px-1 sm:px-2 md:px-4`,children:a.products.map(i=>e.jsx(I,{product:i,className:"w-full h-full"},i.id))}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No hay productos disponibles"}),P=()=>{const i=(a==null?void 0:a.totalPages)||0,s=r.page||1;return i<=1?null:e.jsx("div",{className:"flex justify-center mt-8 space-x-2",children:Array.from({length:i},(t,o)=>o+1).map(t=>e.jsx("button",{onClick:()=>f(t),className:`px-4 py-2 rounded-md ${s===t?"bg-blue-500 text-white":"bg-gray-200"}`,children:t},t))})};return e.jsxs("div",{className:"bg-white min-h-screen",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(O,{title:"GATOTAKU - Tu Tienda de Anime",description:"Descubre nuestra colección de productos de anime. Figuras, mangas, accesorios y más."}),e.jsx("div",{className:"mb-8 bg-gray-50 rounded-lg shadow-md p-6",children:u?e.jsx("h1",{className:"text-3xl font-bold text-gray-800 border-b-2 border-orange-200 pb-2",children:"GATOTAKU"}):e.jsx(z,{onFilterChange:b,currentFilters:r,categories:(a==null?void 0:a.categoriesWithProducts)||[],animes:(a==null?void 0:a.animesWithProducts)||[],onResetFilters:g})}),w(),P()]}),e.jsx(q,{})]})}export{Z as default};
