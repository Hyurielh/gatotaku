import{k as m,j as e,P as _,l as A,T as P,r as d}from"./vendor-9578a473.js";import{s as l,u as O,S as R}from"./index-4584cfc9.js";function B(){const[y,v]=m.useState([]),[u,b]=m.useState(""),[h,j]=m.useState(null),[N,o]=m.useState(null);m.useEffect(()=>{r()},[]);async function r(){const{data:t,error:s}=await l.from("categories").select("*").order("name");if(s){o("Error al cargar categorías");return}v(t||[])}async function n(t){if(t.preventDefault(),o(null),!u.trim())return;const{error:s}=await l.from("categories").insert({name:u.trim()});if(s){o("Error al crear categoría");return}b(""),r()}async function x(t){const{error:s}=await l.from("categories").delete().eq("id",t);if(s){o("Error al eliminar categoría");return}r()}async function g(t,s){const{error:w}=await l.from("categories").update({name:s}).eq("id",t);if(w){o("Error al actualizar categoría");return}j(null),r()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Categorías"}),N&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:N}),e.jsxs("form",{onSubmit:n,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:t=>b(t.target.value),placeholder:"Nueva categoría",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:y.map(t=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[h===t.id?e.jsx("input",{type:"text",defaultValue:t.name,onBlur:s=>g(t.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&g(t.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(t.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar categoría",children:e.jsx(A,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>x(t.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar categoría",children:e.jsx(P,{className:"h-5 w-5"})})]})]},t.id))})]})}function M(){const[y,v]=m.useState([]),[u,b]=m.useState(""),[h,j]=m.useState(null),[N,o]=m.useState(null);m.useEffect(()=>{r()},[]);async function r(){const{data:t,error:s}=await l.from("anime").select("*").order("name");if(s){o("Error al cargar animes");return}v(t||[])}async function n(t){if(t.preventDefault(),o(null),!u.trim())return;const{error:s}=await l.from("anime").insert({name:u.trim()});if(s){o("Error al crear anime");return}b(""),r()}async function x(t){const{error:s}=await l.from("anime").delete().eq("id",t);if(s){o("Error al eliminar anime");return}r()}async function g(t,s){const{error:w}=await l.from("anime").update({name:s}).eq("id",t);if(w){o("Error al actualizar anime");return}j(null),r()}return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Gestionar Animes"}),N&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:N}),e.jsxs("form",{onSubmit:n,className:"mb-6 flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:t=>b(t.target.value),placeholder:"Nuevo anime",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-orange-500"}),e.jsxs("button",{type:"submit",className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Agregar"]})]}),e.jsx("ul",{className:"space-y-2",children:y.map(t=>e.jsxs("li",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[h===t.id?e.jsx("input",{type:"text",defaultValue:t.name,onBlur:s=>g(t.id,s.target.value),onKeyDown:s=>{s.key==="Enter"&&g(t.id,s.currentTarget.value)},className:"flex-1 p-1 border rounded mr-2",autoFocus:!0}):e.jsx("span",{children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(t.id),className:"text-blue-600 hover:text-blue-800","aria-label":"Editar anime",children:e.jsx(A,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>x(t.id),className:"text-red-600 hover:text-red-800","aria-label":"Eliminar anime",children:e.jsx(P,{className:"h-5 w-5"})})]})]},t.id))})]})}function J(){const{session:y,loading:v}=O(),[u,b]=d.useState(()=>[]),[h,j]=d.useState(()=>[]),[N,o]=d.useState(()=>[]),[r,n]=d.useState(()=>({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0})),[x,g]=d.useState(null),[t,s]=d.useState(null),[w,C]=d.useState(!1),[S,I]=d.useState([]);if(v)return e.jsx("div",{children:"Loading..."});if(!y)return e.jsx("div",{children:"Unauthorized Access"});d.useEffect(()=>{k(),U(),F()},[]),d.useEffect(()=>{h.length>0&&!r.category_id&&n(a=>({...a,category_id:h[0].id}))},[h]);const D=async()=>{const a=S.map(async i=>{const c=i.name.split(".").pop(),p=`product-images/${`${Date.now()}.${c}`}`,{error:E}=await l.storage.from("product-images").upload(p,i);if(E)throw console.error("Upload error:",E),E;const{data:{publicUrl:L}}=l.storage.from("product-images").getPublicUrl(p);return L});return Promise.all(a)};async function q(a){if(a.preventDefault(),!r.name||!r.description||!r.price||!r.category_id){s("Por favor complete todos los campos obligatorios");return}try{C(!0),s(null);let i=r.images.filter(p=>p&&p.trim()!=="").map(p=>p.trim());if(S.length>0){const p=await D();i=[...i,...p]}const c={name:r.name,description:r.description,price:parseFloat(r.price),category_id:r.category_id,anime_id:r.anime_id||null,images:i,stock:Number(r.stock)};let f;if(x?f=await l.from("products").update(c).eq("id",x):f=await l.from("products").insert(c),f.error){console.error("Database Operation Error:",f.error),s(`Error guardando producto: ${f.error.message}`);return}n({name:"",description:"",price:"",category_id:"",anime_id:"",images:[""],stock:0}),I([]),g(null),k()}catch(i){console.error("Error submitting product:",i),s("Error al guardar el producto")}finally{C(!1)}}async function k(){const{data:a,error:i}=await l.from("products").select(`
        *,
        category_ref:categories(id, name),
        anime:anime(id, name)
      `).order("created_at",{ascending:!1});if(i){console.error("Error al cargar productos:",i),s("Error al cargar los productos");return}b(a||[])}async function U(){const{data:a}=await l.from("categories").select("*").order("name");j(a||[])}async function F(){const{data:a}=await l.from("anime").select("*").order("name");o(a||[])}async function T(a){if(confirm("¿Estás seguro de que quieres eliminar este producto?"))try{const{error:i}=await l.from("products").delete().eq("id",a);if(i)throw i;k()}catch(i){console.error("Error al eliminar:",i),s(i.message||"Error al eliminar el producto")}}function $(a){n({name:a.name,price:a.price.toString(),category_id:a.category_id||"",anime_id:a.anime_id||"",description:a.description,images:a.images,stock:a.stock||0}),g(a.id)}function z(a,i){const c=[...r.images];c[a]=i,n({...r,images:c})}function G(){n({...r,images:[...r.images,""]})}function K(a){const i=r.images.filter((c,f)=>f!==a);n({...r,images:i})}return e.jsxs("div",{className:"admin-panel",children:[e.jsx(R,{title:"Panel de Administración",description:"Panel de administración de GATOTAKU"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Panel de Administración"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsx(B,{}),e.jsx(M,{})]}),t&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded",children:t}),e.jsxs("form",{onSubmit:q,className:"bg-white p-6 rounded-lg shadow-md mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:x?"Editar Producto":"Nuevo Producto"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx("input",{type:"text",value:r.name,onChange:a=>n({...r,name:a.target.value}),className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{className:"mb-4 flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Precio"}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"C$"})}),e.jsx("input",{type:"number",name:"price",step:"0.01",value:r.price,onChange:a=>n({...r,price:a.target.value}),className:"mt-1 block w-full pl-8 pr-3 py-2 rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm"})]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Stock"}),e.jsx("input",{type:"number",name:"stock",value:r.stock,onChange:a=>n({...r,stock:parseInt(a.target.value)||0}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-black focus:ring-black sm:text-sm",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoría"}),e.jsxs("select",{value:r.category_id,onChange:a=>n({...r,category_id:a.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),h.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Anime"}),e.jsxs("select",{value:r.anime_id,onChange:a=>n({...r,anime_id:a.target.value}),className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Selecciona un anime"}),N.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{value:r.description,onChange:a=>n({...r,description:a.target.value}),className:"w-full p-2 border rounded",rows:3,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[r.images.map((a,i)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"url",value:a,onChange:c=>z(i,c.target.value),className:"flex-1 p-2 border rounded",placeholder:"URL de la imagen",required:!0}),e.jsx("button",{type:"button",onClick:()=>K(i),className:"px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600","aria-label":"Eliminar imagen",children:e.jsx("i",{className:"fas fa-trash"})})]},i)),e.jsxs("button",{type:"button",onClick:G,className:"mt-2 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Agregar imagen"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[x&&e.jsx("button",{type:"button",onClick:()=>{n({name:"",price:"",category_id:"",anime_id:"",description:"",images:[""],stock:0}),g(null)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600",children:[x?"Actualizar":"Crear"," Producto"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoría"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Anime"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(a=>{var i,c;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:a.images[0],alt:a.name,className:"h-10 w-10 rounded-full object-cover"}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.name})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:["$",a.price.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800",children:(i=a.category_ref)==null?void 0:i.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:(c=a.anime)==null?void 0:c.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:a.stock})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>$(a),className:"text-indigo-600 hover:text-indigo-900 mr-4","aria-label":"Editar producto",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{onClick:()=>T(a.id),className:"text-red-600 hover:text-red-900","aria-label":"Eliminar producto",children:e.jsx("i",{className:"fas fa-trash"})})]})]},a.id)})})]})})]})]})}export{J as default};
